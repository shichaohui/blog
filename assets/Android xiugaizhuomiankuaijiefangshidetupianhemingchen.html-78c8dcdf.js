import{_ as t,p,q as e,s as n,R as s,t as o,Y as c,n as l}from"./framework-a25df3d5.js";const i={},u={href:"https://shichaohui.github.io/",target:"_blank",rel:"noopener noreferrer"},r=c(`<p>项目要求在应用运行过程中生成了桌面快捷方式，这个很简单，网上很多资料，但是除了这个还要在应用中修改这些快捷方式的图标和名字，找了很久没有找到方法。</p><p>怎么办呢......</p><p>正在苦恼的时候突然想到：查询快捷方式的时候使用 <code>getContentResolver().query()</code> 方法查询的，这不就是 <code>ContentProvider</code> 提供数据的么，既然如此，那除了 <code>query（）</code> 方法，肯定还有 <code>update()</code> 方法的，找了一下果然有，然后开始测试，发现果然能修改。</p><p>修改之前需要知道名称和图片的列表和数据类型，方法为：通过打印 <code>query()</code> 方法查询出来的数据，直接按 <code>String</code> 类型打印，错了的话，在报错信息中能找到真正的类型，从而得知快捷方式名称的列名为 <code>title</code> 类型为 <code>String</code>，图片的列名为 <code>icon</code> 类型为 <code>Blob</code>，<code>Bolb</code> 类型保存的是二进制数据，因此修改的时候需要把数据转换成 <code>byte[]</code> 才能保存，有了这些东西之后，就能修改图片和名称了。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 根据图标名字更新图标的图片和名字
 * <span class="token keyword">@param</span> <span class="token parameter">oldName</span>
 * <span class="token keyword">@param</span> <span class="token parameter">newName</span>
 * <span class="token keyword">@param</span> <span class="token parameter">bitmap</span>
 */</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">updateShortcut</span><span class="token punctuation">(</span><span class="token class-name">String</span> oldName<span class="token punctuation">,</span> <span class="token class-name">String</span> newName<span class="token punctuation">,</span> <span class="token class-name">Bitmap</span> bitmap<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bitmap --&gt; byte[]</span>
    <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    bitmap<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span><span class="token class-name">Bitmap<span class="token punctuation">.</span>CompressFormat</span><span class="token punctuation">.</span><span class="token constant">PNG</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> baos<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">ContentValues</span> values <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ContentValues</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;icon&quot;</span><span class="token punctuation">,</span> baos<span class="token punctuation">.</span><span class="token function">toByteArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    values<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">,</span> newName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token comment">// 图标的数据表路径</span>
    <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> pName <span class="token operator">=</span> <span class="token function">getAuthorityFromPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>pName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;content://&quot;</span> <span class="token operator">+</span> pName <span class="token operator">+</span> <span class="token string">&quot;/favorites?notify=true&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	pName <span class="token operator">=</span> <span class="token function">getLauncherPackageName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>pName <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token string">&quot;&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pName<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;content://&quot;</span> <span class="token operator">+</span> pName <span class="token operator">+</span> <span class="token string">&quot;.settings/favorites?notify=true&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Build</span><span class="token punctuation">.</span><span class="token constant">VERSION</span><span class="token punctuation">.</span><span class="token constant">SDK_INT</span> <span class="token operator">&lt;</span> <span class="token number">19</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;content://com.android.launcher2.settings/favorites?notify=true&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;content://com.android.launcher3.settings/favorites?notify=true&quot;</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
    <span class="token comment">// 修改</span>
    context<span class="token punctuation">.</span><span class="token function">getContentResolver</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Uri</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">,</span> values<span class="token punctuation">,</span>
            <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">&quot;title=\\&quot;%s\\&quot;&quot;</span><span class="token punctuation">,</span> oldName<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>由于很多厂商对 <code>Launcher</code> 做了定制，因此 <code>Launcher</code> 的包名就不一定是 <code>com.android.launcher2</code> 了，因此需要使用如下方法获取手机当前 <code>Launcher</code> 包名。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token doc-comment comment">/**
 * 获取Launcher的包名
 * 
 * <span class="token keyword">@return</span>
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getAuthorityFromPermission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> permission <span class="token operator">=</span> <span class="token string">&quot;com.android.launcher.permission.READ_SETTINGS&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 权限</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PackageInfo</span><span class="token punctuation">&gt;</span></span> packs <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getPackageManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">getInstalledPackages</span><span class="token punctuation">(</span><span class="token class-name">PackageManager</span><span class="token punctuation">.</span><span class="token constant">GET_PROVIDERS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>packs <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PackageInfo</span> pack <span class="token operator">:</span> packs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">ProviderInfo</span><span class="token punctuation">[</span><span class="token punctuation">]</span> providers <span class="token operator">=</span> pack<span class="token punctuation">.</span>providers<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>providers <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ProviderInfo</span> provider <span class="token operator">:</span> providers<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>provider<span class="token punctuation">.</span>readPermission<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> provider<span class="token punctuation">.</span>authority<span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>permission<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>provider<span class="token punctuation">.</span>writePermission<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token keyword">return</span> provider<span class="token punctuation">.</span>authority<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7);function k(d,m){const a=l("ExternalLinkIcon");return p(),e("div",null,[n("blockquote",null,[n("p",null,[n("small",null,[s("转载请注明出处，"),n("a",u,[s("点击此处"),o(a)]),s(" 查看更多精彩内容。")])])]),r])}const b=t(i,[["render",k],["__file","Android xiugaizhuomiankuaijiefangshidetupianhemingchen.html.vue"]]);export{b as default};
